// Notify(gblTopLevelUser.UPN);
Set(gblLevelLimit, 3);

ClearCollect(
    colUsersRecursive,
    {
        Level: 0,
        UPN: gblTopLevelUser.UPN,
        Prop: gblTopLevelUser.Prop,
        Photo: gblTopLevelUser.Photo,
        Manager: gblTopLevelUser.Manager,
        Direct: gblTopLevelUser.Direct
    }
);

ForAll(
    Sequence(gblLevelLimit) As i,
    ForAll(
        Filter(colUsersRecursive, Level=(i.Value - 1)) As L,
        ForAll(
            Filter(colUsers, Manager.userPrincipalName=L.UPN) As P,
            Collect(
                colUsersRecursive,
                {
                    Level: i.Value,
                    UPN: P.UPN,
                    Prop: P.Prop,
                    Photo: P.Photo,
                    Manager: P.Manager,
                    Direct: P.Direct
                }
            )
        )
    )
);

Set(
    gblUsersRecursive,
    AddColumns(
        GroupBy(
            colUsersRecursive,
            "Level",
            "Users"
        ),
        "Concat",
        Left(Concat(Users, UPN & ","), Len(Concat(Users, UPN & ",")) - 1)
    )
)